# Excel-Lua 5.4 é›†æˆæ’ä»¶

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Excel åŠ è½½å®ï¼Œå…è®¸æ‚¨åœ¨ Excel ä¸­ç›´æ¥ä½¿ç”¨ Lua 5.4 è„šæœ¬è¯­è¨€ï¼Œæ”¯æŒæ™®é€šå‡½æ•°è°ƒç”¨å’Œåç¨‹å¼‚æ­¥ä»»åŠ¡ã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å®‰è£…é…ç½®](#å®‰è£…é…ç½®)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒå‡½æ•°](#æ ¸å¿ƒå‡½æ•°)
- [åç¨‹ä»»åŠ¡ç³»ç»Ÿ](#åç¨‹ä»»åŠ¡ç³»ç»Ÿ)
- [ç›‘æ§ç³»ç»Ÿ](#ç›‘æ§ç³»ç»Ÿ)
- [è°ƒåº¦å™¨é…ç½®](#è°ƒåº¦å™¨é…ç½®)
- [å³é”®èœå•åŠŸèƒ½](#å³é”®èœå•åŠŸèƒ½)
- [functions.lua ç¼–å†™æŒ‡å—](#functionslua-ç¼–å†™æŒ‡å—)
- [é«˜çº§ç‰¹æ€§](#é«˜çº§ç‰¹æ€§)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **Lua è¡¨è¾¾å¼æ±‚å€¼** - ç›´æ¥åœ¨å•å…ƒæ ¼ä¸­æ‰§è¡Œ Lua è¡¨è¾¾å¼
- âœ… **è‡ªå®šä¹‰å‡½æ•°è°ƒç”¨** - è°ƒç”¨ `functions.lua` ä¸­å®šä¹‰çš„å‡½æ•°
- âœ… **åç¨‹ä»»åŠ¡ç³»ç»Ÿ** - æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡
- âœ… **CFS å…¬å¹³è°ƒåº¦** - åŸºäº Linux CFS ç®—æ³•çš„ä»»åŠ¡è°ƒåº¦å™¨
- âœ… **å®æ—¶ç›‘æ§** - ç›‘æ§ä»»åŠ¡çŠ¶æ€å¹¶è‡ªåŠ¨æ›´æ–°å•å…ƒæ ¼

### é«˜çº§ç‰¹æ€§
- ğŸ”„ **çƒ­é‡è½½** - è‡ªåŠ¨æ£€æµ‹ `functions.lua` ä¿®æ”¹å¹¶é‡æ–°åŠ è½½
- ğŸ“Š **æ€§èƒ½ç»Ÿè®¡** - è¯¦ç»†çš„è°ƒåº¦å™¨å’Œä»»åŠ¡æ€§èƒ½åˆ†æ
- ğŸ›ï¸ **çµæ´»é…ç½®** - å¯è°ƒæ•´çš„è°ƒåº¦é—´éš”ã€æƒé‡ã€ä¼˜å…ˆçº§
- ğŸ”— **é—´æ¥å¼•ç”¨** - æ”¯æŒå¤šå±‚å•å…ƒæ ¼å¼•ç”¨è§£æ

---

## å®‰è£…é…ç½®

### ç³»ç»Ÿè¦æ±‚
- Microsoft Excel 2010 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆ64ä½æ¨èï¼‰
- Windows æ“ä½œç³»ç»Ÿ

### å®‰è£…æ­¥éª¤

1. **æ”¾ç½® DLL æ–‡ä»¶**
   ```
   å°† lua54.dll æ”¾ç½®åœ¨ä»¥ä¸‹ä½ç½®ä¹‹ä¸€ï¼š
   - ä¸ .xlam æ–‡ä»¶ç›¸åŒçš„ç›®å½•
   - ç³»ç»Ÿ PATH ç¯å¢ƒå˜é‡åŒ…å«çš„ç›®å½•
   - C:\Windows\System32\
   ```

2. **å®‰è£…åŠ è½½å®**
   ```
   æ–‡ä»¶ â†’ é€‰é¡¹ â†’ åŠ è½½é¡¹ â†’ ç®¡ç†: ExcelåŠ è½½é¡¹ â†’ è½¬åˆ°
   â†’ æµè§ˆ â†’ é€‰æ‹© .xlam æ–‡ä»¶ â†’ ç¡®å®š
   ```

3. **åˆ›å»º functions.lua**
   ```
   åœ¨ .xlam æ–‡ä»¶æ‰€åœ¨ç›®å½•åˆ›å»º functions.lua æ–‡ä»¶
   ```

### ç›®å½•ç»“æ„
```
YourAddinFolder/
â”œâ”€â”€ ExcelLua.xlam          # åŠ è½½å®æ–‡ä»¶
â”œâ”€â”€ lua54.dll              # Lua 5.4 åŠ¨æ€é“¾æ¥åº“
â””â”€â”€ functions.lua          # è‡ªå®šä¹‰ Lua å‡½æ•°
```

---

## å¿«é€Ÿå¼€å§‹

### 1. ç®€å•è¡¨è¾¾å¼æ±‚å€¼
```
=LuaEval("1 + 2 * 3")                    â†’ 7
=LuaEval("math.sqrt(16)")                â†’ 4
=LuaEval("string.upper('hello')")        â†’ HELLO
```

### 2. è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°

åœ¨ `functions.lua` ä¸­å®šä¹‰ï¼š
```lua
function add(a, b)
    return a + b
end
```

åœ¨ Excel ä¸­è°ƒç”¨ï¼š
```
=LuaCall("add", 10, 20)    â†’ 30
```

### 3. åˆ›å»ºå¼‚æ­¥ä»»åŠ¡

åœ¨ `functions.lua` ä¸­å®šä¹‰ï¼š
```lua
function counter(taskCell, startValue)
    local count = startValue or 0
    for i = 1, 10 do
        count = count + 1
        coroutine.yield({
            progress = i * 10,
            message = "è®¡æ•°ä¸­...",
            value = count
        })
    end
    return { status = "done", value = count }
end
```

åœ¨ Excel ä¸­ä½¿ç”¨ï¼š
```
A1: =LuaTask("counter", 100)           â†’ Task_1
B1: =LuaWatch(A1, "progress")          â†’ ç›‘æ§è¿›åº¦
C1: =LuaWatch(A1, "value")             â†’ ç›‘æ§å½“å‰å€¼
```

---

## æ ¸å¿ƒå‡½æ•°

### LuaEval(expression)

æ‰§è¡Œ Lua è¡¨è¾¾å¼å¹¶è¿”å›ç»“æœã€‚

**å‚æ•°ï¼š**
- `expression` (String) - Lua è¡¨è¾¾å¼å­—ç¬¦ä¸²

**è¿”å›å€¼ï¼š**
- è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœ

**ç¤ºä¾‹ï¼š**
```
=LuaEval("10 ^ 2")                      â†’ 100
=LuaEval("{1,2,3}")                     â†’ è¿”å›æ•°ç»„
=LuaEval("os.date('%Y-%m-%d')")         â†’ 2024-01-15
```

---

### LuaCall(funcName, [args...])

è°ƒç”¨ `functions.lua` ä¸­å®šä¹‰çš„å‡½æ•°ã€‚

**å‚æ•°ï¼š**
- `funcName` (String) - å‡½æ•°å
- `args` (Variant) - å¯é€‰ï¼Œä¼ é€’ç»™å‡½æ•°çš„å‚æ•°

**è¿”å›å€¼ï¼š**
- å‡½æ•°çš„è¿”å›å€¼ï¼ˆæ”¯æŒå¤šè¿”å›å€¼ï¼Œæ¨ªå‘å±•å¼€ï¼‰

**ç¤ºä¾‹ï¼š**
```
=LuaCall("sum", A1:A10)                 â†’ æ•°ç»„æ±‚å’Œ
=LuaCall("greet", "å¼ ä¸‰")               â†’ è‡ªå®šä¹‰é—®å€™
=LuaCall("getInfo")                     â†’ æ— å‚å‡½æ•°
```

---

### LuaTask(funcName, [startArgs...], ["|", resumeArgs...])

åˆ›å»ºå¼‚æ­¥åç¨‹ä»»åŠ¡ã€‚

**å‚æ•°ï¼š**
- `funcName` (String) - åç¨‹å‡½æ•°å
- `startArgs` (Variant) - å¯åŠ¨æ—¶ä¼ é€’çš„å‚æ•°
- `"|"` (String) - åˆ†éš”ç¬¦ï¼Œåˆ†éš”å¯åŠ¨å‚æ•°å’Œæ¢å¤å‚æ•°
- `resumeArgs` (Variant) - æ¯æ¬¡æ¢å¤æ—¶ä¼ é€’çš„å‚æ•°

**å‚æ•°ç±»å‹ï¼š**
| ä½ç½® | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| å¯åŠ¨å‚æ•° | ä»»æ„å€¼ | ç›´æ¥ä¼ é€’ç»™å‡½æ•° |
| å¯åŠ¨å‚æ•° | Range | è¯»å–å€¼åä¼ é€’ |
| æ¢å¤å‚æ•° | ä»»æ„å€¼ | æ¯æ¬¡ resume æ—¶ä¼ é€’ |
| æ¢å¤å‚æ•° | Range | æ¯æ¬¡ resume æ—¶è¯»å–æœ€æ–°å€¼ |
| æ¢å¤å‚æ•° | "$A1" | å¼•ç”¨å•å…ƒæ ¼ A1 |
| æ¢å¤å‚æ•° | "$$A1" | é—´æ¥å¼•ç”¨ï¼ˆA1çš„å€¼ä½œä¸ºåœ°å€ï¼‰ |

**è¿”å›å€¼ï¼š**
- ä»»åŠ¡IDï¼ˆå¦‚ "Task_1"ï¼‰

**ç¤ºä¾‹ï¼š**
```
=LuaTask("myTask", 100, "hello")                    â†’ å¯åŠ¨å‚æ•°
=LuaTask("myTask", 100, "|", B1)                    â†’ B1 åŠ¨æ€è¯»å–
=LuaTask("myTask", A1, "|", "$B1", "$$C1")          â†’ æ··åˆå¼•ç”¨
```

---

### LuaGet(taskId, field)

è¯»å–ä»»åŠ¡çŠ¶æ€å­—æ®µï¼ˆé™æ€è¯»å–ï¼Œä¸è‡ªåŠ¨åˆ·æ–°ï¼‰ã€‚

**å‚æ•°ï¼š**
- `taskId` (String) - ä»»åŠ¡ID
- `field` (String) - å­—æ®µå

**å¯ç”¨å­—æ®µï¼š**
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| status | String | ä»»åŠ¡çŠ¶æ€ |
| progress | Number | è¿›åº¦ (0-100) |
| message | String | çŠ¶æ€æ¶ˆæ¯ |
| value | Variant | å½“å‰å€¼ |
| error | String | é”™è¯¯ä¿¡æ¯ |
| summary | String | çŠ¶æ€æ‘˜è¦ |

**ç¤ºä¾‹ï¼š**
```
=LuaGet("Task_1", "status")      â†’ "yield"
=LuaGet("Task_1", "progress")    â†’ 45.5
=LuaGet(A1, "value")             â†’ å½“å‰å€¼
```

---

### LuaWatch(taskId, field, [targetCell], [direction])

ç›‘æ§ä»»åŠ¡å­—æ®µå˜åŒ–ï¼Œè‡ªåŠ¨å†™å…¥ç›®æ ‡å•å…ƒæ ¼ã€‚

**å‚æ•°ï¼š**
- `taskId` (String/Range) - ä»»åŠ¡IDæˆ–åŒ…å«ä»»åŠ¡IDçš„å•å…ƒæ ¼
- `field` (String) - è¦ç›‘æ§çš„å­—æ®µ
- `targetCell` (Range/String) - å¯é€‰ï¼Œå†™å…¥ç›®æ ‡å•å…ƒæ ¼
- `direction` (Integer) - å¯é€‰ï¼Œé»˜è®¤å†™å…¥æ–¹å‘

**æ–¹å‘å€¼ï¼š**
| å€¼ | æ–¹å‘ | è¯´æ˜ |
|----|------|------|
| 0 | å³ | é»˜è®¤ |
| 1 | ä¸Š | |
| 2 | å·¦ | |
| 3 | ä¸‹ | |

**ç¤ºä¾‹ï¼š**
```
=LuaWatch("Task_1", "progress")              â†’ å†™å…¥å³è¾¹å•å…ƒæ ¼
=LuaWatch(A1, "value", D1)                   â†’ å†™å…¥ D1
=LuaWatch(A1, "status", , 3)                 â†’ å†™å…¥ä¸‹æ–¹
```

---

## åç¨‹ä»»åŠ¡ç³»ç»Ÿ

### ä»»åŠ¡çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| `defined` | å·²å®šä¹‰ï¼Œç­‰å¾…å¯åŠ¨ |
| `yield` | è¿è¡Œä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡è°ƒåº¦ |
| `paused` | å·²æš‚åœï¼Œä¸å‚ä¸è°ƒåº¦ |
| `done` | å·²å®Œæˆ |
| `error` | å‘ç”Ÿé”™è¯¯ |
| `terminated` | å·²ç»ˆæ­¢ï¼ˆå·²åˆ é™¤ï¼‰ |

### çŠ¶æ€è½¬æ¢å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   defined   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ å¯åŠ¨
                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚    yield    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚                       â”‚                       â”‚
    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚         â”‚             â”‚             â”‚        â”‚
    â”‚         â–¼             â–¼             â–¼        â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚  paused  â”‚  â”‚   done   â”‚  â”‚   error  â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚        â”‚                                      â”‚
    â”‚        â”‚ æ¢å¤                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Lua åç¨‹å‡½æ•°æ¨¡æ¿

```lua
function myTask(taskCell, arg1, arg2, ...)
    -- taskCell: ä»»åŠ¡æ‰€åœ¨çš„å•å…ƒæ ¼åœ°å€
    -- arg1, arg2...: å¯åŠ¨å‚æ•°
  
    local result = 0
  
    for i = 1, 100 do
        -- æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        result = result + someCalculation(i)
      
        -- é€šè¿‡ yield æš‚åœå¹¶æŠ¥å‘ŠçŠ¶æ€
        local dynamicArg = coroutine.yield({
            progress = i,
            message = "å¤„ç†ç¬¬ " .. i .. " é¡¹",
            value = result
        })
      
        -- dynamicArg æ˜¯ resume æ—¶ä¼ å…¥çš„å‚æ•°
    end
  
    -- è¿”å›æœ€ç»ˆç»“æœ
    return {
        status = "done",
        value = result,
        message = "å®Œæˆ"
    }
end
```

### Yield è¿”å›å€¼æ ¼å¼

```lua
coroutine.yield({
    -- å¯é€‰å­—æ®µ
    progress = 50,              -- è¿›åº¦ (0-100)
    message = "å¤„ç†ä¸­",          -- çŠ¶æ€æ¶ˆæ¯
    value = currentValue,       -- å½“å‰å€¼ï¼ˆä»»æ„ç±»å‹ï¼‰
  
    -- æ§åˆ¶çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
    status = "yield"            -- ç»§ç»­è¿è¡Œï¼ˆé»˜è®¤ï¼‰
    -- status = "paused"        -- æš‚åœä»»åŠ¡
    -- status = "done"          -- æå‰å®Œæˆ
    -- status = "error"         -- æŠ¥å‘Šé”™è¯¯
})
```

---

## ç›‘æ§ç³»ç»Ÿ

### å·¥ä½œåŸç†

1. `LuaWatch` æ³¨å†Œç›‘æ§ç‚¹
2. è°ƒåº¦å™¨æ‰§è¡Œä»»åŠ¡åæ ‡è®°ç›‘æ§ä¸º"è„"
3. è°ƒåº¦å‘¨æœŸç»“æŸæ—¶ç»Ÿä¸€åˆ·æ–°æ‰€æœ‰è„ç›‘æ§
4. å°†æœ€æ–°å€¼å†™å…¥ç›®æ ‡å•å…ƒæ ¼

### ç›‘æ§ç¤ºä¾‹

```
A1: =LuaTask("download", "http://example.com")
B1: =LuaWatch(A1, "status")        â†’ çŠ¶æ€
C1: =LuaWatch(A1, "progress")      â†’ è¿›åº¦
D1: =LuaWatch(A1, "message")       â†’ æ¶ˆæ¯
E1: =LuaWatch(A1, "value")         â†’ ä¸‹è½½çš„æ•°æ®
```

---

## è°ƒåº¦å™¨é…ç½®

### CFS (å®Œå…¨å…¬å¹³è°ƒåº¦) ç®—æ³•

è°ƒåº¦å™¨ä½¿ç”¨ç±»ä¼¼ Linux çš„ CFS ç®—æ³•ï¼š

- **vruntime** - è™šæ‹Ÿè¿è¡Œæ—¶é—´ï¼Œè°ƒåº¦ä¾æ®
- **weight** - ä»»åŠ¡æƒé‡ï¼Œå½±å“ä¼˜å…ˆçº§
- **nice** - ä¼˜å…ˆçº§å€¼ (-20 åˆ° +19)

### é…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| è°ƒåº¦é—´éš” | 1000ms | è°ƒåº¦å™¨å¿ƒè·³é—´éš” |
| ç›®æ ‡å»¶è¿Ÿ | 100ms | æ¯å‘¨æœŸçš„ç›®æ ‡æ‰§è¡Œæ—¶é—´ |
| æœ€å°ç²’åº¦ | 5ms | æœ€å°æ‰§è¡Œæ—¶é—´è®¡é‡ |
| è‡ªåŠ¨æƒé‡ | å…³é—­ | æ˜¯å¦è‡ªåŠ¨è°ƒæ•´æƒé‡ |

### è°ƒåº¦æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ |
|------|------|
| å•è½®æ¨¡å¼ | æ¯ä¸ªå‘¨æœŸåªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ |
| æ—¶é—´ç‰‡æ¨¡å¼ | æ¯ä¸ªå‘¨æœŸæ‰§è¡ŒæŒ‡å®šæ—¶é—´çš„ä»»åŠ¡ |

---

## å³é”®èœå•åŠŸèƒ½

### Lua ä»»åŠ¡ç®¡ç†
- å¯åŠ¨ä»»åŠ¡
- æš‚åœä»»åŠ¡
- æ¢å¤ä»»åŠ¡
- ç»ˆæ­¢ä»»åŠ¡
- é‡ç½®ä»»åŠ¡
- æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
- è®¾ç½®ä»»åŠ¡æƒé‡/Niceå€¼

### Lua è°ƒåº¦ç®¡ç†
- å¯åŠ¨/åœæ­¢è°ƒåº¦å™¨
- å¯åŠ¨æœ¬ç°¿æ‰€æœ‰ä»»åŠ¡
- å¯åŠ¨æ‰€æœ‰ defined ä»»åŠ¡
- æ¸…ç†å®Œæˆ/é”™è¯¯ä»»åŠ¡
- æ¸…ç†å­¤å„¿ç›‘è§†ç‚¹
- æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡

### Lua è®¾ç½®ç®¡ç†
- å¯ç”¨/ç¦ç”¨çƒ­é‡è½½
- è®¾ç½®è°ƒåº¦å‚æ•°
- è®¾ç½®è°ƒåº¦æ¨¡å¼

### Lua æ€§èƒ½ç»Ÿè®¡
- è°ƒåº¦å™¨ç»Ÿè®¡
- ä»»åŠ¡æ€§èƒ½ç»Ÿè®¡
- å·¥ä½œç°¿æ€§èƒ½ç»Ÿè®¡

---

## functions.lua ç¼–å†™æŒ‡å—

### åŸºç¡€å‡½æ•°

```lua
-- ç®€å•å‡½æ•°
function add(a, b)
    return (a or 0) + (b or 0)
end

-- å¤„ç†æ•°ç»„
function sum(arr)
    if type(arr) ~= "table" then return arr end
    local total = 0
    for _, row in ipairs(arr) do
        if type(row) == "table" then
            for _, val in ipairs(row) do
                total = total + (tonumber(val) or 0)
            end
        else
            total = total + (tonumber(row) or 0)
        end
    end
    return total
end

-- è¿”å›è¡¨æ ¼ï¼ˆäºŒç»´æ•°ç»„ï¼‰
function matrix(rows, cols)
    local result = {}
    for i = 1, rows do
        result[i] = {}
        for j = 1, cols do
            result[i][j] = i * j
        end
    end
    return result
end
```

### åç¨‹å‡½æ•°

```lua
-- å¸¦è¿›åº¦çš„é•¿ä»»åŠ¡
function longTask(taskCell, iterations)
    iterations = iterations or 100
    local results = {}
  
    for i = 1, iterations do
        -- æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        local value = math.sin(i * 0.1) * 100
        table.insert(results, value)
      
        -- æŠ¥å‘Šè¿›åº¦
        coroutine.yield({
            progress = (i / iterations) * 100,
            message = string.format("å¤„ç† %d/%d", i, iterations),
            value = #results
        })
    end
  
    return {
        status = "done",
        value = results,
        message = "å®Œæˆ " .. #results .. " é¡¹"
    }
end

-- å¯æš‚åœçš„ä»»åŠ¡
function pausableTask(taskCell)
    local count = 0
  
    while true do
        count = count + 1
      
        local cmd = coroutine.yield({
            progress = (count % 100),
            value = count
        })
      
        -- æ£€æŸ¥å¤–éƒ¨å‘½ä»¤
        if cmd == "stop" then
            return { status = "done", value = count }
        end
    end
end
```

### ä½¿ç”¨åŠ¨æ€å‚æ•°

```lua
function dynamicTask(taskCell, initialValue)
    local value = initialValue or 0
  
    while true do
        -- æ¥æ”¶ resume æ—¶ä¼ å…¥çš„å‚æ•°
        local input = coroutine.yield({
            progress = 50,
            value = value
        })
      
        -- input æ¥è‡ª LuaTask çš„ resumeArgs
        if type(input) == "number" then
            value = value + input
        elseif type(input) == "table" then
            -- å¤„ç†æ•°ç»„è¾“å…¥
            for _, v in ipairs(input) do
                value = value + (tonumber(v) or 0)
            end
        end
    end
end
```

**Excel ä½¿ç”¨ï¼š**
```
=LuaTask("dynamicTask", 0, "|", B1)
```
æ¯æ¬¡è°ƒåº¦æ—¶ï¼ŒB1 çš„æœ€æ–°å€¼ä¼šä¼ é€’ç»™åç¨‹ã€‚

---

## é«˜çº§ç‰¹æ€§

### é—´æ¥å¼•ç”¨

```
A1: B5          â† å­˜å‚¨ç›®æ ‡åœ°å€
B5: 100         â† å®é™…å€¼

=LuaTask("myTask", 0, "|", "$$A1")
```
- è¯»å– A1 å¾—åˆ° "B5"
- è¯»å– B5 å¾—åˆ° 100
- ä¼ é€’ 100 ç»™åç¨‹

**å¤šå±‚é—´æ¥å¼•ç”¨ï¼š**
```
A1: B1
B1: C1
C1: 999

"$$$A1" â†’ è¯»å– A1â†’B1â†’C1â†’999
```

### å·¥ä½œç°¿éš”ç¦»

æ¯ä¸ªå·¥ä½œç°¿çš„ä»»åŠ¡ç›¸äº’ç‹¬ç«‹ï¼š
- å…³é—­å·¥ä½œç°¿è‡ªåŠ¨æ¸…ç†ç›¸å…³ä»»åŠ¡
- æ”¯æŒæŒ‰å·¥ä½œç°¿æŸ¥çœ‹ç»Ÿè®¡

### çƒ­é‡è½½

å¯ç”¨åï¼Œä¿®æ”¹ `functions.lua` ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ï¼š
- ä¸å½±å“æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡
- æ–°ä»»åŠ¡ä½¿ç”¨æ–°ç‰ˆæœ¬å‡½æ•°

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æç¤º "æ— æ³•åˆ›å»º Lua çŠ¶æ€æœº"**
```
A: æ£€æŸ¥ lua54.dll æ˜¯å¦åœ¨æ­£ç¡®ä½ç½®
   - ä¸ .xlam åŒç›®å½•
   - æˆ–åœ¨ç³»ç»Ÿ PATH ä¸­
```

**Q: å‡½æ•°è°ƒç”¨è¿”å› "å‡½æ•°ä¸å­˜åœ¨"**
```
A: 
   1. æ£€æŸ¥ functions.lua è¯­æ³•
   2. ç¡®è®¤å‡½æ•°åæ‹¼å†™æ­£ç¡®
   3. å°è¯•æ‰‹åŠ¨é‡è½½ï¼šå³é”® â†’ Luaè®¾ç½®ç®¡ç† â†’ æ‰‹åŠ¨é‡è½½
```

**Q: ä»»åŠ¡å¡åœ¨ yield çŠ¶æ€**
```
A:
   1. æ£€æŸ¥è°ƒåº¦å™¨æ˜¯å¦è¿è¡Œï¼šå³é”® â†’ å¯åŠ¨è°ƒåº¦å™¨
   2. æ£€æŸ¥ä»»åŠ¡æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­ï¼šå³é”® â†’ æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡
```

**Q: ç›‘æ§å€¼ä¸æ›´æ–°**
```
A:
   1. ç¡®è®¤ä»»åŠ¡æ­£åœ¨è¿è¡Œ
   2. æ£€æŸ¥ç›‘æ§æ˜¯å¦æ³¨å†Œï¼šå³é”® â†’ æ˜¾ç¤ºç›‘è§†å™¨çŠ¶æ€
   3. æ£€æŸ¥æ˜¯å¦æœ‰å­¤å„¿ç›‘æ§éœ€è¦æ¸…ç†
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‡å°‘ yield é¢‘ç‡** - ä¸è¦æ¯æ¬¡å¾ªç¯éƒ½ yield
2. **ä½¿ç”¨æ‰¹é‡å¤„ç†** - åˆå¹¶å°æ“ä½œ
3. **è°ƒæ•´è°ƒåº¦é—´éš”** - æ ¹æ®ä»»åŠ¡ç‰¹æ€§è®¾ç½®
4. **ä½¿ç”¨æ—¶é—´ç‰‡æ¨¡å¼** - å¤šä»»åŠ¡æ—¶æ›´å…¬å¹³

---

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬ï¼š** 1.0
- **Lua ç‰ˆæœ¬ï¼š** 5.4
- **å…¼å®¹æ€§ï¼š** Excel 2010+ (64ä½)

---

## è®¸å¯è¯

[MIT License](LICENSE)

---

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼